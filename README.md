# 2023 Starter Kit 


## Backend 
- Inspo: https://github.com/mattddowney/compose-postgrest/blob/master/docker-compose.yml 
- PSQL (db), Prisma (migrations), postgrest (API service)
- Should also think about a simple node server for doing other API calls to DB - e.g., there is the prisma client there, but the issue is the prisma client does not help with autogenerating API endpoint documentation like postgrest does 
- Traefik for managing reverse proxy/routing 
    - need to still go through a tutorial like this to figure out best way for routing multiple services


        https://github.com/traefik/traefik/issues/9565 


        - https://graspingtech.com/docker-compose-traefik/ 
        - https://stackoverflow.com/questions/58945381/cant-get-multiple-services-running-behind-traefik-on-the-same-host 
        - https://stackoverflow.com/questions/60849312/multiple-docker-compose-files-with-traefik-v2-1-and-database-networks 
        - https://community.traefik.io/t/configuration-for-multiple-app/12007/3 
        - https://ptrk.io/posts/2017/10/multi-https-sub-domain-with-traefik-and-docker-part-1/ 
        - https://medium.com/trabe/map-subdomains-to-docker-containers-with-traefik-efd6aa66e073 
        - 
        - most detailed below !!!!
        - https://spad.uk/practical-configuration-of-traefik-as-a-reverse-proxy-for-docker/ 
        - https://doc.traefik.io/traefik/routing/services/

        - Great tutorial for basic of TRAEFIK v1 versus v2 
            - v1: has frontend/backend 
            - v2: removed frontend/back with routers and services 

        - !!!! GOOD TUTORIAL that uses route53 / aws dynamic routing for some oracle service with 3 separate IPs 
            - https://dimensionquest.net/2021/12/how-to-load-balance-vcloud-director-with-traefik/ 
        - another goon one like above, but using HPE VMs for something: 
            - https://docs.datafabric.hpe.com/70/MapROverview/traefik_load_balancing.html 
                ```
                services:
                    moss-service:
                        loadBalancer: 
                            servers: 
                            - url: "http://m2-hux6k-34-n2.mip.storage.hpecorp.net:9000"
                            - url : "http://m2-hux6k-34-n4.mip.storage.hpecorp.net:9000"
                ```

        - External machine simplified: 
            - https://community.traefik.io/t/proxy-to-real-host-on-another-machine/6229/3 
            - perhaps not as simplifer, but can review: https://blog.eleven-labs.com/en/using-traefik-as-a-reverse-proxy/ 

        - 
        - https://dev.to/maxencehenneron/automatic-dns-and-ssl-management-with-traefik-8cc 
        - https://github.com/DoTheEvo/Traefik-v2-examples 
            - if you go to the bottom of this exampoe, DoTheEvo - there is a example of having one single traefik docker instance, and only 2 DNS mods that need to be done, to then have unlimited number of subdomains going through that traefik server 
    - google search: 'traefik multiple apps on different subdomains' 


- Setup - BACKEND - : 
    - Run the docker-compose file in postgres
    - Then update the prisma.schema to your liking 
    - Exec the initial migraitons with prisma // recommend just using `npx prisma db push` - no need for migrations files yet 
    - Then restart the docker-compose, found that the postgrest sometimes needs to restart
    - Should then be able to go to:
        - localhost:3000 to see the OpenAPI self-documentation hosted at the API root path
        - localhost:8080 and see the autogenerated swagger interface / nice  
            - when doing additional `db push` in the future, you might need to restart the individual docker image for the API endpoint, which can be achieved by doing getting the container name, and then doing: `docker kill -s SIGUSR1` or in docker-compose `docker-compose kill -s SIGUSR1 <service>` 
            - the interesting and annoying piece here, is that the new columns will appear at the BOTTOM of the documentation / section 
            - they do appear, but not in the right order 

    - the auto API schema generation/making calls is interesting, will take some time to get used to: 
        - making big calls are simple, e.g., if you have a Users table: 
            - `http://localhost:3000/Users`
        - then if you want to just find a specific user with the name: 
            - `http://localhost:3000/Users?email=eq.hants@optionsmd.com` 
        - for just getting specific columns: 
            - `http://localhost:3000/Users?select=id,email` 
        - search for a email that contains hants: 
            - `http://localhost:3000/Users?email=like.*hants*` - uses * instead of % for pattern matching due to URL encoding 
        - all of the different operators and located in the TABLES AND VIEWS section of https://postgrest.org/en/stable/api.html 
